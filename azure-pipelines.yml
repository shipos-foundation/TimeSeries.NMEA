trigger:
- master

pool: 
  vmImage: "ubuntu-latest"

variables:
  buildConfiguration: "Release"
  imageName: "shipos/timeseries-nmea"
  
stages:
  - stage: Build
    jobs:
      - job: "DotNet"
        steps:
        - checkout: self
          submodules: recursive

        - bash: dotnet restore --no-cache --verbosity normal
          displayName: Restore

        - bash: dotnet build --no-restore --configuration Release
          displayName: Build

        - bash: dotnet test --configuration Release --no-build
          displayName: Test

      - job: "DockerBuild"
        steps:
        - script: export versionTag=$(git tag --sort=-version:refname | head -1)
        - bash: echo "$(imageName):$(versionTag)"
        - bash: docker build --no-cache -f ./Source/Dockerfile -t $(imageName):$(versionTag) . --build-arg CONFIGURATION="Release"
  - stage: Push
    jobs:
      - job: "DockerPush"
        steps:
        - bash: echo "$(imageName):$(versionTag)"




